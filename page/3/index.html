<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.zhaoweiguo.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true,"width":300,"b2t":true,"scrollpercent":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Just do it now.">
<meta property="og:type" content="website">
<meta property="og:title" content="新溪blog">
<meta property="og:url" content="http://blog.zhaoweiguo.com/page/3/index.html">
<meta property="og:site_name" content="新溪blog">
<meta property="og:description" content="Just do it now.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="赵卫国">
<meta property="article:tag" content="golang,erlang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.zhaoweiguo.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>新溪blog - 新溪-gordon之胡写乱画</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">新溪blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">新溪-gordon之胡写乱画</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="bullhorn fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">37</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">13</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">42</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2019/03/10/question-dns-domain-expired/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/10/question-dns-domain-expired/" class="post-title-link" itemprop="url">域名过期导致的一系列问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-10 13:22:09" itemprop="dateCreated datePublished" datetime="2019-03-10T13:22:09+08:00">2019-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/question/" itemprop="url" rel="index"><span itemprop="name">question</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>域名是通过代理商在阿里买的，然后域名解析用的腾讯dnspod的收费版<br>域名过期消息通知都是发到代理商那里，我们不知道域名过期这事<br>过期后，阿里把权威dns改成EXPIRENS3.HICHINA.COM/EXPIRENS4.HICHINA.COM。<br>于是域名解析有问题了，但这个问题因为dns缓存机制，延迟了1整天才被发现。<br>续费后，权威dns修改正常，同样因为dns缓存机制，有48小时的缓存时间，所以有很多地方请求还是有问题<br>有一部分机器请求阿里的那个权威dns，一部分请求腾讯的权威dns，而请求阿里那部分失败。</p>
<h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><p>中间经历了各种尝试就不细说了，最后<br>在阿里上也修改二级域名记录，修改后，不管是请求哪个权威dns,结果都是对的<br>原因可能是:</p>
<pre><code>阿里过期dns对不过期的域名也做了域名解析
阿里云对顶级域服务器来说是有可控的写入权的销售商
</code></pre>
<p>问题虽然解决，但以前对dns了解很浅，得把这个问题彻底搞明白<br>以后再遇到dns的其他问题，就能做到心中有数了</p>
<h3 id="相关定义"><a href="#相关定义" class="headerlink" title="相关定义"></a>相关定义</h3><p>权威DNS:</p>
<pre><code>权威DNS是经过上一级授权对域名进行解析的服务器，同时它可以把解析授权转授给其他人，如:
  COM顶级服务器可以授权dns.com这个域名的的权威服务器为NS.ABC.COM
  同时NS.ABC.COM还可以把授权转授给NS.DDD.COM
  这样NS.DDD.COM就成了ABC.COM实际上的权威服务器了
平时我们解析域名的结果都源自权威DNS。比如:
  dns.com的权威DNS服务器就是帝恩思的ns1.dns.com ns2.dns.com
  ali云的权威DNS服务器是:
      DNS9.HICHINA.COM
      DNS10.HICHINA.COM
  dnspod权威dns:
      NS3.DNSV3.COM
      NS3.DNSV3.COM
</code></pre>
<p>递归DNS:</p>
<pre><code>负责接受用户对任意域名查询，并返回结果给用户。递归DNS可以缓存结果以避免重复向上查询。
平时使用最多的就是这类DNS，对公众开放服务，一般由网络运营商提供，自己可以架递归DNS提供服务
递归DNS一定要有可靠的互联网连接方可使用。比如:
  谷歌的8.8.8.8和8.8.4.4
  114的114.114.114.114和114.114.115.115都属于这一类DNS
你本地电脑上设置的DNS就是这类DNS
</code></pre>
<p>转发DNS:</p>
<pre><code>负责接受用户查询，并返回结果给用户。
但此结果不是按标准域名解析过程得到的，而是直接把递归DNS的结果转发给用户。它也具备缓存功能。
他主要使用在没有直接的互联网连接，但可以连接到一个递归DNS那里，这时使用转发DNS就比较合适。
其缺陷是：
  直接受递归DNS的影响，服务品质较差。
如路由器里面的DNS就是这一类，用路由器的朋友可以看下本地电脑的DNS一般都是192.168.1.1
</code></pre>
<h3 id="域名解析过程"><a href="#域名解析过程" class="headerlink" title="域名解析过程"></a>域名解析过程</h3><p>用户—本地递归服务器—根权威服务器—COM权威服务器—xxorg.com权威服务器—用户<br>对顶级域服务器来说销售商有可控的写入权。</p>
<p>递归服务器怎么知道根权威服务器的地址？</p>
<pre><code>很简单，在递归服务器上都保存有一份根服务器的地址列表。最新的根服务器地址列表在这里可以得到：
ftp://ftp.internic.net/domain/named.root
</code></pre>
<p>递归服务器每次查询域名都要向根那里找权威服务器吗？</p>
<pre><code>不是的，一旦成功一次，递归服务器就会把权威服务器列表缓存下来
如COM顶级服务器列表可以缓存48小时
</code></pre>
<p>操作步骤:</p>
<pre><code>1、在浏览器中输入www.qq.com 域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。
2、如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。
3、如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/ip参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。
4、如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。
5、如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(http://qq.com)给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找http://qq.com域服务器，重复上面的动作，进行查询，直至找到www.qq.com主机。
6、如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。https://www.nslookuptool.com 可以查询在进行DNS修改后，域名被各个地区的域名服务器收录的情况，以及当前收录的域名对应的ip地址。
</code></pre>
<h3 id="一些信息"><a href="#一些信息" class="headerlink" title="一些信息"></a>一些信息</h3><p>13台根DNS服务器在全球的放置:</p>
<pre><code>美国VeriSign公司 2台
美国PSINet公司 1台
美国ISI(Information Sciences Institute) 1台
美国ISC(Internet Software Consortium) 1台
美国马里兰大学(University of Maryland) 1台
美国太空总署(NASA) 1台
美国国防部 1台
美国陆军研究所 1台
挪威NORDUnet 1台
日本WIDE(Widely Integrated Distributed Environments)研究计划 1台
网络管理组织IANA(Internet Assigned Number Authority) 1台
欧洲网络管理组织RIPE-NCC(Resource IP Europeens Network Coordination Centre) 1台
</code></pre>
<p>CANN在中国大陆授权的10家国际域名注册商:</p>
<pre><code>ChinaSource Internet Service Co., Ltd.（中资源）
ename Co.,Ltd.（易名中国）
35 Technology Co., Ltd.（三五科技）
Beijing Innovative Linkage Technology Ltd.（新网互联）
Bizcn.com, Inc.（商务中国）
HiChina Web Solutions (Hong Kong) Limited（万网）
Inter China Network Software (Beijing) Co., Ltd.（3721）
OnlineNIC, Inc.（厦门精通，即中国频道）
Todaynic.com, Inc.（时代互联）
Xin Net Technology Corporation（新网）
</code></pre>
<h3 id="dig命令的使用"><a href="#dig命令的使用" class="headerlink" title="dig命令的使用"></a>dig命令的使用</h3><p>$ dig +trace blog.zhaoweiguo.com:</p>
<pre><code>; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Debian &lt;&lt;&gt;&gt; +trace blog.zhaoweiguo.com
;; global options: +cmd
.     172206  IN  NS  m.root-servers.net.
.     172206  IN  NS  b.root-servers.net.
.     172206  IN  NS  c.root-servers.net.
.     172206  IN  NS  d.root-servers.net.
.     172206  IN  NS  e.root-servers.net.
.     172206  IN  NS  f.root-servers.net.
.     172206  IN  NS  g.root-servers.net.
.     172206  IN  NS  h.root-servers.net.
.     172206  IN  NS  i.root-servers.net.
.     172206  IN  NS  j.root-servers.net.
.     172206  IN  NS  a.root-servers.net.
.     172206  IN  NS  k.root-servers.net.
.     172206  IN  NS  l.root-servers.net.
.     172206  IN  RRSIG NS 8 0 518400 20190323050000 20190310040000 16749 . TgmuL0MjWMidemDVGJC+v5G2BsE33xO5rayFm8qYfOLlNh8kiM9MtLsD Xicpzchrt3/OI+mOh2t/UyQJ4njI1PTP3MXwkUIgVHEx8rF5vYJKrMyP E4Mohd8XZ2nClb6qyvWk+dIYwE14aPpIonkU7L2wE4uxiGCl6lW9Q0GL j8UDyi4D7UkEHJ8qVebWzYDSeuhv+kWRHJqY7M1/MY/HezA1h6qNyw08 FmRGpf+/xT8bahzIQ1wY9yQwOmBjFhB6KZIxehsB/1HEHP44QuCQRz3R gI4IHwuDW+vw9wOvhM4lqLukONqQ7p3/xHFGlgKyYA+EboF/0QgPaXtF 7ri06w==
;; Received 525 bytes from 8.8.4.4#53(8.8.4.4) in 33 ms

说明:
  从本地递归dns(8.8.4.4)取出13台全球根域名服务器的地址
  继续向这13台全球根域名服务器请求.com顶级域名服务器地址，以最先回复的为准

com.      172800  IN  NS  a.gtld-servers.net.
com.      172800  IN  NS  b.gtld-servers.net.
com.      172800  IN  NS  c.gtld-servers.net.
com.      172800  IN  NS  d.gtld-servers.net.
com.      172800  IN  NS  e.gtld-servers.net.
com.      172800  IN  NS  f.gtld-servers.net.
com.      172800  IN  NS  g.gtld-servers.net.
com.      172800  IN  NS  h.gtld-servers.net.
com.      172800  IN  NS  i.gtld-servers.net.
com.      172800  IN  NS  j.gtld-servers.net.
com.      172800  IN  NS  k.gtld-servers.net.
com.      172800  IN  NS  l.gtld-servers.net.
com.      172800  IN  NS  m.gtld-servers.net.
com.      86400 IN  DS  30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766
com.      86400 IN  RRSIG DS 8 1 86400 20190324050000 20190311040000 16749 . qNqvX6qD9q7IJMn09ue59cubovzfECVYmWPmNUdHtDEiaBIjNFP8oaA7 pT4B/JA43tQTsPF1B9wC/zivN63n7xv4fNpdY2rXXgGsZX9ycme22kKt dZ/kV6rpiMoSCvZ8qmUlWWKkiq3aXYCYVznWoA9s3xM8oFUNG839N1ke OWiYQlGZn8LoETkUiPG4qCsARNdb/DMrj0BOywzYhO00lc/DnyHvgbT5 l7Dzi+Abxs2jZohrz270A19Sed9l2xulBq+6Y4ryxFYhr6hk6pZ0PqgJ tnMDI05n2mMls0xmpE61u/V2mJxSGAcb3s6UTAlXIPENnx23q4YeLgy/ zh058A==
;; Received 1179 bytes from 192.58.128.30#53(j.root-servers.net) in 308 ms

说明:
  最先回复的根域名服务器是j.root-servers.net(192.58.128.30)
  返回13台.com顶级域名服务器的域名和地址，继续向这些.com顶级域名服务器请求
  查询zhaoweiguo.com二级域名服务器地址

zhaoweiguo.com.   172800  IN  NS  dns9.hichina.com.
zhaoweiguo.com.   172800  IN  NS  dns10.hichina.com.
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A  NS SOA RRSIG DNSKEY NSEC3PARAM
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20190316044521 20190309043521 16883 com. DHkCBLG4YbAgDR7yj/Qu+LD/prXqR7NdPThP3mqis2aQcYw2WC6Y5Baq fCdYF1c1bgT9oBe/SusdZgqT56CzrXoF+G1MwRIrMdHCUHvR6BU28GCw 2rJJ9wcmrri2+mWHA0W1qBpt8bm0K3/V2FmLDtit0bJyUyZkfQ8BtRBB hZ8=
KOHGII341DQ77IRB2UN8I8B4L5DQADV9.com. 86400 IN NSEC3 1 1 0 - KOHGO5POINBII7KFF2Q6VC4IKISTH7NC  NS DS RRSIG
KOHGII341DQ77IRB2UN8I8B4L5DQADV9.com. 86400 IN RRSIG NSEC3 8 2 86400 20190318045050 20190311034050 16883 com. gHTSd9Z23gcTTVjl8dLYUBhGXZrMXITQd0q1JwJd+copTe6F+gcIG8DX LhiGiGO2XQtbovo6Lfe9QWtLj3yBa6apIQ2XSab+VpJugPASNDu/8zKX 2v4sPVqvm1kjcIMX6nPwcQVVyAFcVu5uKTH+344QWf8lbpBmCwfNk2TW /0Y=
;; Received 892 bytes from 192.43.172.30#53(i.gtld-servers.net) in 267 ms

说明:
  最先回复的.com顶级域名服务器是i.gtld-servers.net(192.42.93.30)
  (gtld是global top level domain的缩写)
  返回2台zhaoweiguo.com二级域名服务器的域名和地址
  继续向这2个结果请求查询blog.zhaoweiguo.com三级域名服务器

blog.zhaoweiguo.com.  600 IN  CNAME zhaoweiguo.github.io.
;; Received 82 bytes from 106.11.141.116#53(dns10.hichina.com) in 43 ms

说明:
  最先回复的zhaoweiguo.com二级域名服务器是dns10.hichina.com(106.11.141.116)
  返回1个A记录，其中A记录就是最终的解析地址
注意:
  如果阿里域名用dnspod解析,会多出2条NS记录
  blog.zhaoweiguo.com.  600 IN  A 115.29.97.185
  zhaoweiguo.com.    86400 IN  NS  f1g1ns1.dnspod.net.
  zhaoweiguo.com.    86400 IN  NS  f1g1ns2.dnspod.net.
</code></pre>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>从整体对DNS有了大概的了解，很细节的东西还不是很清楚，需要自己手动搭建一个DNS服务实践一下<br>从现在的了解的情况来看，有几个时间:</p>
<ol>
<li><p>域名解析时的TTL:递归DNS缓存过期时间:</p>
<p> 大多设置为10分钟<br> 域名请求递归DNS时，会直接从缓存中取数据，数据过期后，可能会:<br>   a. 直接请求顶级DNS，取得权威DNS，再请求二级权威DNS得到ip<br>   b. a请求超时，请求根DNS，再依次取得顶级DNS，二级权威DNS得到ip</p>
</li>
<li><p>顶级DNS更新权威DNS时间:</p>
<p> 这个大多是48小时内，最高可达72小时<br> 这也是我们遇到这个问题的根源所在</p>
</li>
</ol>
<h3 id="一些实用网站"><a href="#一些实用网站" class="headerlink" title="一些实用网站"></a>一些实用网站</h3><p>https://www.nslookuptool.com<br>https://www.17ce.com</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>https://www.dns.com/supports/681.html<br>https://www.jianshu.com/p/babca8224e60</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2019/02/20/erlang/erlang-collect-mnesia-delect-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/02/20/erlang/erlang-collect-mnesia-delect-object/" class="post-title-link" itemprop="url">mnesia:delect_object只删除索引问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-02-20 11:46:03" itemprop="dateCreated datePublished" datetime="2019-02-20T11:46:03+08:00">2019-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/erlang/" itemprop="url" rel="index"><span itemprop="name">erlang</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近遇到一个奇怪的问题，mnesia数据有时能查出来有时查不出来，细查发现是mnesia:delect_object删除时，只删除了索引，没有删除具体的数据</p>
<h3 id="问题重现"><a href="#问题重现" class="headerlink" title="问题重现"></a>问题重现</h3><ol>
<li>表结构:</li>
</ol>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-<span class="built_in">record</span>(gordon_test, &#123;</span><br><span class="line">    idr,    % &#123;<span class="built_in">id</span>, pid&#125;</span><br><span class="line">    <span class="built_in">id</span>,</span><br><span class="line">    pid,</span><br><span class="line">    locale,</span><br><span class="line">    <span class="built_in">time</span> = os:timestamp()</span><br><span class="line">&#125;).</span><br></pre></td></tr></table></figure>

<ol>
<li>初使化代码:</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mnesia:<span class="built_in">create_table</span>(gordon_test, [</span><br><span class="line">    &#123;ram_copies, [<span class="built_in">node</span>() | <span class="built_in">nodes</span>()]&#125;,</span><br><span class="line">    &#123;attributes, record_info(fields, gordon_test)&#125;</span><br><span class="line">]),</span><br><span class="line">mnesia:<span class="built_in">add_table_index</span>(gordon_test, id),</span><br><span class="line">mnesia:<span class="built_in">add_table_index</span>(gordon_test, pid).</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>插入数据:</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mnesia:dirty<span class="constructor">_write(<span class="params">gordon_test</span>, &#123;<span class="params">gordon_test</span>, &#123;1, 1&#125;, 1, 1, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="params">os</span>:<span class="params">timestamp</span>()</span>&#125;).</span><br><span class="line">mnesia:dirty<span class="constructor">_write(<span class="params">gordon_test</span>, &#123;<span class="params">gordon_test</span>, &#123;2, 2&#125;, 2, 2, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="params">os</span>:<span class="params">timestamp</span>()</span>&#125;).</span><br><span class="line">mnesia:dirty<span class="constructor">_write(<span class="params">gordon_test</span>, &#123;<span class="params">gordon_test</span>, &#123;3, 3&#125;, 3, 3, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="params">os</span>:<span class="params">timestamp</span>()</span>&#125;).</span><br></pre></td></tr></table></figure>

<p>3.查询:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Id = <span class="number">3</span>,</span><br><span class="line">Pid = <span class="number">3</span>,</span><br><span class="line">% 查出id=<span class="number">3</span>的所有记录，都能查出一条记录</span><br><span class="line">mnesia:dirty<span class="constructor">_index_read(<span class="params">gordon_test</span>, Id, #<span class="params">gordon_test</span>.<span class="params">id</span>)</span>,</span><br><span class="line">mnesia:dirty<span class="constructor">_index_match_object(#<span class="params">gordon_test</span>&#123;<span class="params">idr</span> = &#x27;$1&#x27;,<span class="params">id</span>=Id, <span class="params">_</span>=&#x27;<span class="params">_</span>&#x27;&#125;, #<span class="params">gordon_test</span>.<span class="params">id</span>)</span>,</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>执行删除:</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mnesia:dirty<span class="constructor">_delete_object(X#<span class="params">gordon_test</span>&#123;<span class="params">locale</span> = <span class="params">aaaa</span>&#125;)</span>.</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">Trans = <span class="keyword">fun</span><span class="literal">()</span> -&gt;</span><br><span class="line">    mnesia:delete<span class="constructor">_object(X#<span class="params">gordon_test</span>&#123;<span class="params">locale</span> = <span class="params">aaaa</span>&#125;)</span></span><br><span class="line">        <span class="keyword">end</span>,</span><br><span class="line">mnesia:transaction(Trans)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>两次查询，dirty_index_read查不到数据:</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% 数据查询为空</span><br><span class="line">mnesia:dirty<span class="constructor">_index_read(<span class="params">gordon_test</span>, Id, #<span class="params">gordon_test</span>.<span class="params">id</span>)</span>,</span><br><span class="line">% 数据不变</span><br><span class="line">mnesia:dirty<span class="constructor">_index_match_object(#<span class="params">gordon_test</span>&#123;<span class="params">idr</span> = &#x27;$1&#x27;,<span class="params">id</span>=Id, <span class="params">_</span>=&#x27;<span class="params">_</span>&#x27;&#125;, #<span class="params">gordon_test</span>.<span class="params">id</span>)</span>,</span><br></pre></td></tr></table></figure>

<h3 id="问题定位"><a href="#问题定位" class="headerlink" title="问题定位"></a>问题定位</h3><p>查文档:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">If</span> a <span class="keyword">table</span> <span class="keyword">is</span> <span class="keyword">of</span> <span class="keyword">type</span> bag, it can sometimes be needed <span class="keyword">to</span> <span class="keyword">delete</span> <span class="keyword">only</span> <span class="keyword">some</span> <span class="keyword">of</span> the records <span class="keyword">with</span> a certain key. </span><br><span class="line">This can be done <span class="keyword">with</span> the <span class="keyword">function</span> delete_object/<span class="number">3.</span> A complete <span class="type">record</span> must be supplied <span class="keyword">to</span> this <span class="keyword">function</span>.</span><br><span class="line"></span><br><span class="line">The semantics <span class="keyword">of</span> this <span class="keyword">function</span> <span class="keyword">is</span> context-sensitive. <span class="keyword">For</span> details, see mnesia:activity/<span class="number">4.</span> </span><br><span class="line"><span class="keyword">In</span> <span class="keyword">transaction</span>-context, it acquires a <span class="keyword">lock</span> <span class="keyword">of</span> <span class="keyword">type</span> LockKind <span class="keyword">on</span> the <span class="type">record</span>. </span><br><span class="line">Currently, the <span class="keyword">lock</span> <span class="keyword">types</span> <span class="keyword">write</span> <span class="keyword">and</span> sticky_write are supported.</span><br></pre></td></tr></table></figure>

<h3 id="深层研究"><a href="#深层研究" class="headerlink" title="深层研究"></a>深层研究</h3><p>待继续 @todo</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2019/02/10/erlang/erlang-collect-spawn-infinite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/02/10/erlang/erlang-collect-spawn-infinite/" class="post-title-link" itemprop="url">Erlang不断spawn新进程会有什么现象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-02-10 10:26:00" itemprop="dateCreated datePublished" datetime="2019-02-10T10:26:00+08:00">2019-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/erlang/" itemprop="url" rel="index"><span itemprop="name">erlang</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近和同事聊天的时候，我突然想到进程Pid格式为&lt;A1, A2, A3&gt;，其中A1代表Node值, A2, A3则代表指定Node下的进程值，开始A3为0。当A2的值增加到一定数后, A3的值加1，那么问题来了:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>. A<span class="number">2</span>增加到多少，A<span class="number">3</span>加<span class="number">1</span></span><br><span class="line"><span class="attribute">2</span>. 如果A<span class="number">3</span>的值也增加到这个值后会有什么情况出现呢?</span><br></pre></td></tr></table></figure>

<h3 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h3><p>源码:</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-module</span><span class="params">(spawn_loop_infinite2)</span>.</span><br><span class="line"><span class="keyword">-author</span><span class="params">(<span class="string">&quot;zhaoweiguo&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% API</span></span><br><span class="line"><span class="keyword">-export</span><span class="params">([loop/<span class="number">1</span>])</span>.</span><br><span class="line"><span class="keyword">-export</span><span class="params">([do_nothing/<span class="number">0</span>])</span>.</span><br><span class="line"><span class="keyword">-export</span><span class="params">([loop1/<span class="number">2</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">loop</span><span class="params">(N)</span> -&gt;</span></span><br><span class="line">    &#123;ok, F&#125; = file:open(<span class="string">&quot;aaa.txt&quot;</span>, [append]),</span><br><span class="line">    loop1(F, N).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">loop1</span><span class="params">(_F, <span class="number">0</span>)</span> -&gt;</span></span><br><span class="line">    ok;</span><br><span class="line"><span class="function"><span class="title">loop1</span><span class="params">(F, N)</span> -&gt;</span></span><br><span class="line">    Pid = spawn(spawn_loop_infinite, do_nothing, []),</span><br><span class="line">    file:write(F, io_lib:format(<span class="string">&quot;[~p]:(~p)~n&quot;</span>, [N, Pid])),</span><br><span class="line">    loop1(F, N-<span class="number">1</span>).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_nothing</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    ok.</span><br></pre></td></tr></table></figure>

<p>执行命令:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">erl</span>&gt; spawn_loop_infinite<span class="number">2</span>:loop(<span class="number">33000</span>).</span><br></pre></td></tr></table></figure>

<p>打开文件aaa.txt:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">303</span>]:<span class="link">(&lt;0.32766.0&gt;)</span></span><br><span class="line">[<span class="symbol">302</span>]:<span class="link">(&lt;0.32767.0&gt;)</span></span><br><span class="line">[<span class="symbol">301</span>]:<span class="link">(&lt;0.0.1&gt;)</span></span><br><span class="line">[<span class="symbol">300</span>]:<span class="link">(&lt;0.1.1&gt;)</span></span><br><span class="line">[<span class="symbol">299</span>]:<span class="link">(&lt;0.2.1&gt;)</span></span><br></pre></td></tr></table></figure>

<p>结论:</p>
<pre><code>A2增加到32767，A3加1
</code></pre>
<h3 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h3><p>源码:</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% 每次生成100万新进程，打印下一进程的pid，休息0.1秒后再生成100万新进程</span></span><br><span class="line"><span class="keyword">-module</span><span class="params">(spawn_loop_infinite)</span>.</span><br><span class="line"><span class="keyword">-author</span><span class="params">(<span class="string">&quot;zhaoweiguo&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% API</span></span><br><span class="line"><span class="keyword">-export</span><span class="params">([loop/<span class="number">2</span>])</span>.</span><br><span class="line"><span class="keyword">-export</span><span class="params">([do_nothing/<span class="number">0</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">loop</span><span class="params">(N, N)</span> -&gt;</span></span><br><span class="line">    io:format(<span class="string">&quot;stop~n&quot;</span>);</span><br><span class="line"><span class="function"><span class="title">loop</span><span class="params">(M, N)</span> -&gt;</span></span><br><span class="line">    Add = <span class="number">32768</span>*<span class="number">10</span>,</span><br><span class="line">    io:format(<span class="string">&quot;~p;&quot;</span>, [N]),</span><br><span class="line">    &#123;ok, F&#125; = file:open(<span class="string">&quot;fff&quot;</span>++ integer_to_list(N) ++<span class="string">&quot;.txt&quot;</span>, [append]),</span><br><span class="line">    loop1(Add, N, F),</span><br><span class="line">    file:close(F),</span><br><span class="line">    timer:sleep(<span class="number">10</span>),</span><br><span class="line">    loop(M, N+<span class="number">1</span>).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">loop1</span><span class="params">(<span class="number">0</span>, _N, _F)</span> -&gt;</span></span><br><span class="line">    ok;</span><br><span class="line"><span class="function"><span class="title">loop1</span><span class="params">(Add, N, F)</span> -&gt;</span></span><br><span class="line">    Pid = spawn(spawn_loop_infinite, do_nothing, []),</span><br><span class="line">    file:write(F, io_lib:format(<span class="string">&quot;[~p]:(~p)~n&quot;</span>, [Add, Pid])),</span><br><span class="line">    loop1(Add-<span class="number">1</span>, N, F).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_nothing</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    ok.</span><br></pre></td></tr></table></figure>

<p>在文件fff820.txt中看到::</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">296800</span>]:<span class="link">(&lt;0.32762.8191&gt;)</span></span><br><span class="line">[<span class="symbol">296799</span>]:<span class="link">(&lt;0.32763.8191&gt;)</span></span><br><span class="line">[<span class="symbol">296798</span>]:<span class="link">(&lt;0.32764.8191&gt;)</span></span><br><span class="line">[<span class="symbol">296797</span>]:<span class="link">(&lt;0.32765.8191&gt;)</span></span><br><span class="line">[<span class="symbol">296796</span>]:<span class="link">(&lt;0.32766.8191&gt;)</span></span><br><span class="line">[<span class="symbol">296795</span>]:<span class="link">(&lt;0.32767.7&gt;)</span></span><br><span class="line">[<span class="symbol">296794</span>]:<span class="link">(&lt;0.5.0&gt;)</span></span><br><span class="line">[<span class="symbol">296793</span>]:<span class="link">(&lt;0.7.0&gt;)</span></span><br><span class="line">[<span class="symbol">296792</span>]:<span class="link">(&lt;0.11.0&gt;)</span></span><br><span class="line">[<span class="symbol">296791</span>]:<span class="link">(&lt;0.8.0&gt;)</span></span><br><span class="line">[<span class="symbol">296790</span>]:<span class="link">(&lt;0.17.0&gt;)</span></span><br><span class="line">[<span class="symbol">296789</span>]:<span class="link">(&lt;0.16.0&gt;)</span></span><br><span class="line">[<span class="symbol">296788</span>]:<span class="link">(&lt;0.24.0&gt;)</span></span><br><span class="line">[<span class="symbol">296787</span>]:<span class="link">(&lt;0.6.0&gt;)</span></span><br><span class="line">...</span><br><span class="line">[<span class="symbol">296755</span>]:<span class="link">(&lt;0.72.0&gt;)</span></span><br><span class="line">[<span class="symbol">296754</span>]:<span class="link">(&lt;0.73.0&gt;)</span></span><br><span class="line">[<span class="symbol">296753</span>]:<span class="link">(&lt;0.74.0&gt;)</span></span><br><span class="line">[<span class="symbol">296752</span>]:<span class="link">(&lt;0.75.0&gt;)</span></span><br><span class="line">[<span class="symbol">296751</span>]:<span class="link">(&lt;0.76.0&gt;)</span></span><br><span class="line">[<span class="symbol">296750</span>]:<span class="link">(&lt;0.77.0&gt;)</span></span><br><span class="line">[<span class="symbol">296749</span>]:<span class="link">(&lt;0.78.0&gt;)</span></span><br></pre></td></tr></table></figure>

<p>结论:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">A3</span>在增加到<span class="number">8191</span>后就不再增加,改为使用已经回收的进程</span><br><span class="line">经过很短的混乱后又变的有序起来</span><br><span class="line">之后每一次<span class="built_in">A3</span>+<span class="number">1</span>都会先乱,再有序,并且乱的顺序都是对的</span><br></pre></td></tr></table></figure>

<p>其他发现:</p>
<figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% 有个有趣的发现, 在每次进程到达<span class="attribute">&lt;0.32766.8191&gt;</span>后产生的下一个进程分别是:</span><br><span class="line"><span class="attribute">&lt;0.32767.7&gt;</span></span><br><span class="line"><span class="attribute">&lt;0.32767.15&gt;</span></span><br><span class="line"><span class="attribute">&lt;0.32767.23&gt;</span></span><br><span class="line"><span class="attribute">&lt;0.32767.31&gt;</span></span><br><span class="line"><span class="attribute">&lt;0.32767.39&gt;</span></span><br><span class="line"><span class="attribute">&lt;0.32767.47&gt;</span></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2019/01/12/question-certificate-expired/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/12/question-certificate-expired/" class="post-title-link" itemprop="url">网站证书过期导致的一系列问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-12 13:22:09" itemprop="dateCreated datePublished" datetime="2019-01-12T13:22:09+08:00">2019-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:02" itemprop="dateModified" datetime="2022-03-18T14:39:02+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/question/" itemprop="url" rel="index"><span itemprop="name">question</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>谷歌提议将证书有效期缩短到13个月，被其他CA和浏览器厂商无情拒绝，但缩短有效期是人心所向<br>于是，CAB Forum第193号投票确定最长SSL证书有效期由原来的3年(39个月)改为2年(825天)</p>
<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>这一个项目是物联网相关的，有app和硬件设备两种类型的client<br>因历史原来，两种client用的是一个域名，都使用了ssl证书<br>证书有效期可能很长，但最近到期了<br>因为设备没办法强制升级，一是设备可能没联网，二是有些设备还没销售出去，三是设备没有用ca对证书校验<br>于是解决方案是，app强制升级，升级后使用新域名，新证书<br>但到了域名过期那天，才发现这么一个问题:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">之前宣传部门印制了许多二维码，用的是原来老域名</span><br><span class="line">所以这些二维码现在不可用了</span><br></pre></td></tr></table></figure>

<p>当然，以后二维码使用专门的短域名、app和设备域名不应该用同一个……<br>未来如何做是另一码事，现在要想如何解决问题</p>
<p>要想达到的结果是:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在不影响设备使用的前提下，让一指定uri可用</span><br></pre></td></tr></table></figure>

<p>举例说明:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.如有一个域名www.<span class="keyword">abc</span>.<span class="keyword">com</span>，给硬件设备用，也给app用</span><br><span class="line"><span class="number">2</span>.最近域名证书过期了，要换证书，但硬件设备没法保证用户升级，于是让app强制升级启用新域名</span><br><span class="line"><span class="number">3</span>.但有一批二维码，已经发出去了，请求地址为: www.<span class="keyword">abc</span>.<span class="keyword">com</span>/<span class="keyword">a</span>/<span class="keyword">b</span>/<span class="keyword">c</span></span><br></pre></td></tr></table></figure>

<p>现在想有没有方法，让:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="selector-class">.www</span><span class="selector-class">.abc</span>.com/a/b/c 使用新证书，或不用证书，只要在浏览器中打开就行</span><br><span class="line"><span class="number">2</span><span class="selector-class">.www</span><span class="selector-class">.abc</span>.com其他地址使用老证书，保证设备的可用</span><br></pre></td></tr></table></figure>

<h2 id="问题解决方案"><a href="#问题解决方案" class="headerlink" title="问题解决方案"></a>问题解决方案</h2><h4 id="方案1-双证书方案"><a href="#方案1-双证书方案" class="headerlink" title="方案1:双证书方案"></a>方案1:双证书方案</h4><p>原理:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Nginx支持<span class="built_in">ECC</span>、RSA双证书. </span><br><span class="line"><span class="built_in">ECC</span>签个最新的，保障较新设备能够正常访问</span><br><span class="line">RSA依旧保留过期的旧证书，给未更新的设备访问</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.设备使用的一般是乐鑫ESP8266或庆科EMW3162的板子实现ssl</span><br><span class="line">    而这些板子下的ssl库一般都不支持<span class="built_in">ECC</span></span><br><span class="line"><span class="number">2</span>. 除非很古老的浏览器，其他都支持<span class="built_in">ECC</span></span><br><span class="line"></span><br><span class="line">所以使用Nginx判断:</span><br><span class="line">  如果支持<span class="built_in">ECC</span>则使用新的<span class="built_in">ECC</span>证书</span><br><span class="line">  如果不支持<span class="built_in">ECC</span>则使用老的RSA证书</span><br></pre></td></tr></table></figure>

<p>说明:</p>
<pre><code>Windows XP 中，使用 ECC 证书的网站时需要浏览器自行 TLS
Android 平台中，也需要 Android 4+ 才支持 ECC 证书
</code></pre>
<p>如果此方案能生效，可以保证:</p>
<pre><code>1.所有的请求都可以完美成功
2.甚至都不需要更换域名
</code></pre>
<h4 id="方案2-使用openResty"><a href="#方案2-使用openResty" class="headerlink" title="方案2:使用openResty"></a>方案2:使用openResty</h4><p>原理:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.所有的设备请求第<span class="number">1</span>次失败后会再次请求</span><br><span class="line"><span class="number">2</span>.证书错误时，请求快速失败</span><br><span class="line"></span><br><span class="line">所以在openResty中做一个k/v表</span><br><span class="line">第一次请求给他返回新证书，并以<span class="built_in">ip</span>为key插入一条数据，<span class="number">5</span>秒失效</span><br><span class="line">第二次请求过来，一查k/v表，有数据，返回老证书</span><br></pre></td></tr></table></figure>

<p>说明:</p>
<pre><code>此方案会有一定误杀的情况
</code></pre>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>我们的设备中有一部分用带有OS的系统，是支持ECC的<br>这些设备对我们来说是很重要的，所以最后我们采用了方案2</p>
<h2 id="双证书的一些简单操作"><a href="#双证书的一些简单操作" class="headerlink" title="双证书的一些简单操作"></a>双证书的一些简单操作</h2><p>生成证书:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl ecparam -genkey -name prime256v1 -out 证书名<span class="selector-class">.key</span></span><br><span class="line">openssl req -new -key 证书名<span class="selector-class">.key</span> -nodes -out 证书名<span class="selector-class">.csr</span></span><br><span class="line">例:</span><br><span class="line">openssl ecparam -genkey -name prime256v1 -out www<span class="selector-class">.zhaoweiguo</span><span class="selector-class">.com</span><span class="selector-class">.key</span></span><br><span class="line">openssl req -new -sha256 -key www<span class="selector-class">.zhaoweiguo</span><span class="selector-class">.com</span><span class="selector-class">.key</span> -nodes -out www<span class="selector-class">.zhaoweiguo</span><span class="selector-class">.com</span>.csr</span><br></pre></td></tr></table></figure>

<p>Nginx配置双证书rsa+ecc:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 它的实现原理是:</span></span><br><span class="line"><span class="comment"># 分析在 TLS 握手中双方协商得到的 Cipher Suite</span></span><br><span class="line"><span class="comment"># 若支持 ECDSA 就返回 ECC 证书，反之返回 RSA 证书</span></span><br><span class="line">server&#123;</span><br><span class="line">    listen <span class="number">443</span> ssl;</span><br><span class="line">    server_name www.zhaoweiguo.com;</span><br><span class="line">    root <span class="regexp">/var/</span>www<span class="regexp">/zhaoweiguo.com/</span>www.zhaoweiguo.com;</span><br><span class="line">    index index.php index.html;</span><br><span class="line"></span><br><span class="line">    ssl_certificate  <span class="regexp">/home/</span>wei64/www.zhaoweiguo.com.crt;</span><br><span class="line">    ssl_certificate_key  <span class="regexp">/home/</span>wei64<span class="regexp">/nginx/</span>ca/www.zhaoweiguo.com.key;</span><br><span class="line"></span><br><span class="line">    ssl_certificate  <span class="regexp">/home/</span>wei64<span class="regexp">/nginx/</span>ca/www.zhaoweiguo.com.ecc.crt;</span><br><span class="line">    ssl_certificate_key  <span class="regexp">/home/</span>wei64<span class="regexp">/nginx/</span>ca/www.zhaoweiguo.com.ecc.key;</span><br><span class="line"></span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    <span class="comment">## Cipher Suites 一定要配置好，不然双证书并不会生效</span></span><br><span class="line">    ssl_ciphers <span class="string">&quot;EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2018/11/21/erlang/erlang-tune-lager2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/21/erlang/erlang-tune-lager2/" class="post-title-link" itemprop="url">lager实战2:写文件、写kafka的性能测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-21 13:22:09" itemprop="dateCreated datePublished" datetime="2018-11-21T13:22:09+08:00">2018-11-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tune/" itemprop="url" rel="index"><span itemprop="name">tune</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考项目:</p>
<pre><code>https://github.com/klarna/brod
https://github.com/erlang-lager/lager
http://kafka.apache.org
https://github.com/newforks/lager_kafka_backend
</code></pre>
<p>测试目的:</p>
<pre><code>项目使用lager写日志时，如果日志量非常大，会导致消息队列堆积，进而引起更严重的问题,
于是想着增加一kafka的backend:
  一是为了把所有日志合并在一起
  二是为了增加写入效率
</code></pre>
<p>测试对比:</p>
<pre><code>1. 测试file写入文件中带delayed_write与不带的性能对比
2. 测试brod写kafka与file写入的性能对比
3. 测试lager_kafka_backend与lager_file_backend的性能对比
</code></pre>
<p>测试内容:</p>
<pre><code>写入数据: &lt;&lt;&quot;123456789qwertyuiopasdfghjklzxcvbnm&quot;&gt;&gt;
执行Module:loop(Times, Num).
其中:
  Times: 为执行次数
  Num: 每次执行写入数据次数
</code></pre>
<p>代码实例:</p>
<pre><code>1. 普通文件写入: 
https://github.com/zhaoweiguo/demo-erlang/blob/6829ca950f2ea16859d3be23a1396aa3d1fdaf2d/apps/demo_lager/src/speed_file.erl

2. 带delayed_write文件写入:
https://github.com/zhaoweiguo/demo-erlang/blob/6829ca950f2ea16859d3be23a1396aa3d1fdaf2d/apps/demo_lager/src/speed_delayfile.erl

3. 普通写kafka(注:要本地启动kafka server)
https://github.com/zhaoweiguo/demo-erlang/blob/6829ca950f2ea16859d3be23a1396aa3d1fdaf2d/apps/demo_lager/src/speed_brod.erl

4. 通过lager写入文件
https://github.com/zhaoweiguo/demo-erlang/blob/6829ca950f2ea16859d3be23a1396aa3d1fdaf2d/apps/demo_lager/src/speed_lager_file.erl

5. 通过lager写入kafka
https://github.com/zhaoweiguo/demo-erlang/blob/6829ca950f2ea16859d3be23a1396aa3d1fdaf2d/apps/demo_lager/src/speed_lager_kafka.erl
</code></pre>
<p>测试结果:</p>
<p>(demo_lager@127.0.0.1)3&gt; speed_file:loop(20, 20).</p>
<pre><code>% 测试过程中文件写入不稳定,有时写入数据差10倍以上，原因不明
time:384 | &#123;0,0,384&#125;
time:833 | &#123;0,0,833&#125;
time:2734 | &#123;0,2,734&#125;
time:484 | &#123;0,0,484&#125;
time:642 | &#123;0,0,642&#125;
time:483 | &#123;0,0,483&#125;
time:609 | &#123;0,0,609&#125;
time:582 | &#123;0,0,582&#125;
time:844 | &#123;0,0,844&#125;
time:795 | &#123;0,0,795&#125;
time:506 | &#123;0,0,506&#125;
time:1125 | &#123;0,1,125&#125;
time:490 | &#123;0,0,490&#125;
time:599 | &#123;0,0,599&#125;
time:605 | &#123;0,0,605&#125;
time:444 | &#123;0,0,444&#125;
time:479 | &#123;0,0,479&#125;
time:415 | &#123;0,0,415&#125;
time:421 | &#123;0,0,421&#125;
time:577 | &#123;0,0,577&#125;
</code></pre>
<p>(demo_lager@127.0.0.1)4&gt; speed_delayfile:loop(20, 20).</p>
<pre><code>time:39 | &#123;0,0,39&#125;
time:98 | &#123;0,0,98&#125;
time:78 | &#123;0,0,78&#125;
time:86 | &#123;0,0,86&#125;
time:83 | &#123;0,0,83&#125;
time:149 | &#123;0,0,149&#125;
time:51 | &#123;0,0,51&#125;
time:461 | &#123;0,0,461&#125;
time:85 | &#123;0,0,85&#125;
time:58 | &#123;0,0,58&#125;
time:56 | &#123;0,0,56&#125;
time:108 | &#123;0,0,108&#125;
time:60 | &#123;0,0,60&#125;
time:87 | &#123;0,0,87&#125;
time:62 | &#123;0,0,62&#125;
time:58 | &#123;0,0,58&#125;
time:151 | &#123;0,0,151&#125;
time:417 | &#123;0,0,417&#125;
time:75 | &#123;0,0,75&#125;
time:109 | &#123;0,0,109&#125;
</code></pre>
<p>(demo_lager@127.0.0.1)14&gt; speed_brod:loop(20, 20).</p>
<pre><code>time:2900 | &#123;0,2,900&#125;
time:229 | &#123;0,0,229&#125;
time:243 | &#123;0,0,243&#125;
time:293 | &#123;0,0,293&#125;
time:971 | &#123;0,0,971&#125;
time:191 | &#123;0,0,191&#125;
time:183 | &#123;0,0,183&#125;
time:607 | &#123;0,0,607&#125;
time:253 | &#123;0,0,253&#125;
time:256 | &#123;0,0,256&#125;
time:233 | &#123;0,0,233&#125;
time:257 | &#123;0,0,257&#125;
time:145 | &#123;0,0,145&#125;
time:195 | &#123;0,0,195&#125;
time:175 | &#123;0,0,175&#125;
time:135 | &#123;0,0,135&#125;
time:197 | &#123;0,0,197&#125;
time:189 | &#123;0,0,189&#125;
time:166 | &#123;0,0,166&#125;
time:200 | &#123;0,0,200&#125;
</code></pre>
<p>(demo_lager@127.0.0.1)15&gt; speed_lager_kafka:loop(20, 20).</p>
<pre><code>time:136 | &#123;0,0,136&#125;
time:176 | &#123;0,0,176&#125;
time:203 | &#123;0,0,203&#125;
time:198 | &#123;0,0,198&#125;
time:161 | &#123;0,0,161&#125;
time:161 | &#123;0,0,161&#125;
time:192 | &#123;0,0,192&#125;
time:141 | &#123;0,0,141&#125;
time:229 | &#123;0,0,229&#125;
time:235 | &#123;0,0,235&#125;
time:253 | &#123;0,0,253&#125;
time:247 | &#123;0,0,247&#125;
time:189 | &#123;0,0,189&#125;
time:201 | &#123;0,0,201&#125;
time:150 | &#123;0,0,150&#125;
time:189 | &#123;0,0,189&#125;
time:153 | &#123;0,0,153&#125;
time:235 | &#123;0,0,235&#125;
time:161 | &#123;0,0,161&#125;
time:176 | &#123;0,0,176&#125;
</code></pre>
<p>(demo_lager@127.0.0.1)18&gt; speed_lager_file:loop(20, 20).</p>
<pre><code>time:189 | &#123;0,0,189&#125;
time:192 | &#123;0,0,192&#125;
time:233 | &#123;0,0,233&#125;
time:277 | &#123;0,0,277&#125;
time:177 | &#123;0,0,177&#125;
time:183 | &#123;0,0,183&#125;
time:179 | &#123;0,0,179&#125;
time:290 | &#123;0,0,290&#125;
time:218 | &#123;0,0,218&#125;
time:208 | &#123;0,0,208&#125;
time:215 | &#123;0,0,215&#125;
time:256 | &#123;0,0,256&#125;
time:263 | &#123;0,0,263&#125;
time:287 | &#123;0,0,287&#125;
time:238 | &#123;0,0,238&#125;
time:294 | &#123;0,0,294&#125;
time:226 | &#123;0,0,226&#125;
time:276 | &#123;0,0,276&#125;
time:195 | &#123;0,0,195&#125;
time:332 | &#123;0,0,332&#125;
</code></pre>
<p>结论:</p>
<pre><code>1.直接写文件，加不加buffer影响很大
2.直接写kafka，比不加buffer的快，但比加buffer的慢
3.通过lager_file_backend与通过lager_kafka_backend性能差别不大
4.通过lager_file_backend加不加buffer，影响不大
5.可能是虚拟机原因，磁盘写入不稳定
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2018/11/09/erlang/erlang-source-analysis-lager6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/09/erlang/erlang-source-analysis-lager6/" class="post-title-link" itemprop="url">开源项目lager6-写一个lager的kafka插件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-09 09:19:11" itemprop="dateCreated datePublished" datetime="2018-11-09T09:19:11+08:00">2018-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-analysis/" itemprop="url" rel="index"><span itemprop="name">source-analysis</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>配置文件:</p>
<pre><code>[
 &#123;handlers,[&#123;lager_kafka_backend,[
              &#123;level,                         &quot;info&quot;&#125;,
              &#123;topic,                         &lt;&lt;&quot;topic&quot;&gt;&gt;&#125;,
              &#123;broker,                        [&#123;&quot;localhost&quot;, 9092&#125;]&#125;,
              &#123;send_method,                   async&#125;,
              &#123;formatter,                     lager_default_formatter&#125;,
              &#123;formatter_config,
                [date, &quot; &quot;, time, &quot;|&quot;, node, &quot;|&quot;,severity,&quot;|&quot;, module, &quot;|&quot;, function, &quot;|&quot;, line, &quot;|&quot;, pid, &quot;|&quot;, message]
              &#125;     
           ]&#125;]
  &#125;
]
</code></pre>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/11/09/erlang/erlang-source-analysis-lager6/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2018/11/05/erlang/erlang-source-analysis-lager5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/05/erlang/erlang-source-analysis-lager5/" class="post-title-link" itemprop="url">开源项目lager5-其他边边角角</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-05 09:19:11" itemprop="dateCreated datePublished" datetime="2018-11-05T09:19:11+08:00">2018-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-analysis/" itemprop="url" rel="index"><span itemprop="name">source-analysis</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="trace-filter"><a href="#trace-filter" class="headerlink" title="trace_filter"></a>trace_filter</h3><p>执行lager_util:trace_filter(none):</p>
<pre><code>glc:compile(lager_default_tracer, glc:null(false))
</code></pre>
<p>lager_app:add_configured_traces/1:</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/11/05/erlang/erlang-source-analysis-lager5/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2018/11/04/erlang/erlang-source-analysis-lager4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/04/erlang/erlang-source-analysis-lager4/" class="post-title-link" itemprop="url">开源项目lager4:lager写入函数分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-04 09:19:11" itemprop="dateCreated datePublished" datetime="2018-11-04T09:19:11+08:00">2018-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:02" itemprop="dateModified" datetime="2022-03-18T14:39:02+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-analysis/" itemprop="url" rel="index"><span itemprop="name">source-analysis</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原始使用:</p>
<pre><code>lager:info(&quot;handle_call _Request = ~p&quot;,[_Request]),
</code></pre>
<p>最本质是调用:</p>
<pre><code>lager:do_log(info,
   [
        &#123;application, mongrel&#125;, 
        &#123;module, mongrel&#125;,
        &#123;function, handle_call&#125;, 
        &#123;line, 79&#125;,
        &#123;pid, pid_to_list(self())&#125;, 
        &#123;node, node()&#125;
        | lager:md()
    ],
   &quot;handle_call _Request= ~p&quot;, 
   [_Request], 
   4096, 
   4,
   __Leveldemo_lager_server42, 
   __Tracesdemo_lager_server42, 
   lager_event, 
   __Piddemo_lager_server42
);

do_log(Severity, Metadata, Format, Args, Size, SeverityAsInt, LevelThreshold, TraceFilters, Sink, SinkPid)
</code></pre>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/11/04/erlang/erlang-source-analysis-lager4/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2018/11/03/erlang/erlang-source-analysis-lager3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/03/erlang/erlang-source-analysis-lager3/" class="post-title-link" itemprop="url">开源项目lager3-设置阀值相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-03 09:19:11" itemprop="dateCreated datePublished" datetime="2018-11-03T09:19:11+08:00">2018-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-analysis/" itemprop="url" rel="index"><span itemprop="name">source-analysis</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="lager-backend-throttle"><a href="#lager-backend-throttle" class="headerlink" title="lager_backend_throttle"></a>lager_backend_throttle</h3><p>入口:</p>
<pre><code>init([&#123;sink, Sink&#125;, Hwm, Window])
</code></pre>
<p>表:</p>
<pre><code>表lager_config:
&#123;&#123;lager_event,async&#125;, true&#125;,
</code></pre>
<p>状态:</p>
<pre><code>#state&#123;sink=Sink, hwm=Hwm, window_min=Hwm - Window&#125;
% Sink=lager_event
% Threshold=env(async_threshold)
% Window=env(async_threshold_window)
</code></pre>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/11/03/erlang/erlang-source-analysis-lager3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoweiguo.com/2018/11/02/erlang/erlang-source-analysis-lager2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon.png">
      <meta itemprop="name" content="zhaoweiguo">
      <meta itemprop="description" content="Just do it now.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="新溪blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/02/erlang/erlang-source-analysis-lager2/" class="post-title-link" itemprop="url">开源项目lager2-application启动</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-02 09:19:11" itemprop="dateCreated datePublished" datetime="2018-11-02T09:19:11+08:00">2018-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-18 14:39:03" itemprop="dateModified" datetime="2022-03-18T14:39:03+08:00">2022-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-analysis/" itemprop="url" rel="index"><span itemprop="name">source-analysis</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="lager-sup"><a href="#lager-sup" class="headerlink" title="lager_sup"></a>lager_sup</h3><p>1.ets表:lager_config:</p>
<pre><code>% 初使化时往表里增加2条数据
1.1 Sink
&#123;lager_event, loglevel&#125; =&gt; &#123;Int, []&#125;
例:&#123;lager_event,loglevel&#125;, &#123;255,[]&#125;
其中: Int为8位的整形,即下面的and操作
  -define(DEBUG, 128).
  -define(INFO, 64).
  -define(NOTICE, 32).
  -define(WARNING, 16).
  -define(ERROR, 8).
  -define(CRITICAL, 4).
  -define(ALERT, 2).
  -define(EMERGENCY, 1).
  -define(LOG_NONE, 0).

1.2 Handlers
&#123;_global, handlers&#125; =&gt; []
</code></pre>
<p>2.三个子进程one_for_one:</p>
<pre><code>&#123;lager, &#123;gen_event, start_link, [&#123;local, lager_event&#125;]&#125;,
        permanent, 5000, worker, dynamic&#125;
&#123;lager_handler_watcher_sup, &#123;lager_handler_watcher_sup, start_link, []&#125;,
        permanent, 5000, supervisor, [lager_handler_watcher_sup]&#125;
//可选,根据env(crash_log)的值
&#123;lager_crash_log, &#123;lager_crash_log, start_link, [File, MaxBytes,
  RotationSize, RotationDate, RotationCount, RotationMod]&#125;,
  permanent, 5000, worker, [lager_crash_log]&#125;
</code></pre>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/11/02/erlang/erlang-source-analysis-lager2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhaoweiguo"
      src="/images/icon.png">
  <p class="site-author-name" itemprop="name">zhaoweiguo</p>
  <div class="site-description" itemprop="description">Just do it now.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3poYW93ZWlndW8=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhaoweiguo"><i class="github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnN1cHBvcnRAemhhb3dlaWd1by5jb20=" title="E-Mail → mailto:support@zhaoweiguo.com"><i class="envelope fa-fw"></i></span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">京ICP备16018553号 </span>
  </div>

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhaoweiguo</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">185k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:49</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
